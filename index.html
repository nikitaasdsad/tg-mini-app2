<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ì–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è ‚Äî –º–∏–Ω–∏-–∞–ø–ø</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f1113;
    --card:#121316;
    --muted:#bfc7cd;
    --accent:#2EA44F;
    --accent-2:#ff7ab6;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:var(--bg); color:#fff}
  .wrap{max-width:1100px;margin:14px auto;padding:12px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  h1{font-size:18px;margin:0;font-weight:700}
  .subtitle{color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  @media(min-width:900px){ .grid{grid-template-columns:repeat(4,1fr);} }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
    border-radius:12px; overflow:hidden; position:relative; box-shadow:0 8px 30px rgba(0,0,0,0.6);
    transform-origin:center; transition:transform .25s ease, box-shadow .25s ease;
    cursor:pointer;
  }
  .card:hover{ transform:translateY(-6px) scale(1.03); box-shadow:0 18px 40px rgba(0,0,0,0.7); }
  .thumb{width:100%; aspect-ratio:1/1; object-fit:cover; display:block; transition:transform .4s ease;}
  .card:hover .thumb{ transform:scale(1.06); }
  .overlay{
    position:absolute; left:0; right:0; bottom:0;
    background:linear-gradient(0deg, rgba(0,0,0,0.85), rgba(0,0,0,0.12));
    padding:12px; transform: translateY(100%); transition: transform .22s ease;
    display:flex; flex-direction:column; gap:6px;
  }
  .card:hover .overlay, .card.show-overlay .overlay{ transform: translateY(0%); }
  .title{font-weight:700;font-size:14px}
  .short{font-size:13px;color:var(--muted);line-height:1.2}
  .btn-row{display:flex;gap:8px;margin-top:8px}
  .btn{padding:8px 10px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff}
  .btn.primary{background:var(--accent);color:#06140a}
  .detail{display:none}
  .detail.active{display:block}
  .detail .viewer{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  .viewer .imgwrap {
  width: min(100%, 1024px);
  aspect-ratio: 1/1;
  background:#000;
  border-radius:10px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

.viewer img {
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}
  .nav{display:flex;gap:8px;justify-content:center;margin-top:10px}
  .pager{display:flex;gap:6px;justify-content:center;margin-top:8px}
  .dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.12)}
  .dot.active{background:var(--accent)}
  .caption{color:var(--muted);margin-top:10px}
  .detail-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;gap:8px}

  /* Modal styles */
  .modal-backdrop{
    position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center;
    z-index:1000; opacity:0; pointer-events:none; transition:opacity .18s ease;
    backdrop-filter: blur(6px);
  }
  .modal-backdrop.show{ opacity:1; pointer-events:auto; }
  .modal{
    width: min(720px, 94%);
    background: linear-gradient(180deg, rgba(18,19,22,0.98), rgba(14,15,17,0.98));
    border-radius:12px; padding:18px; box-shadow:0 30px 80px rgba(0,0,0,0.7); transform: translateY(12px) scale(.98); transition:transform .18s ease, opacity .18s ease;
  }
  .modal-backdrop.show .modal{ transform: translateY(0) scale(1); }
  .modal-header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .modal-title{font-size:18px;font-weight:700}
  .modal-close{background:transparent;border:0;color:var(--muted);font-size:18px;cursor:pointer;padding:6px;border-radius:6px}
  .modal-body{margin-top:12px;display:flex;gap:18px;align-items:center}
  .code-big{font-family:monospace;font-size:34px;letter-spacing:2px;padding:12px 18px;border-radius:10px;background:rgba(0,0,0,0.35);display:inline-block}
  .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:16px}
  .muted{color:var(--muted);font-size:13px}

  @media(max-width:600px){
    .modal-body{flex-direction:column;align-items:stretch}
    .code-big{font-size:28px;text-align:center}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>üìö –ì–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è</h1>
      <div class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ü–µ–Ω—É ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ –µ—ë –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ê—Ä–µ–Ω–¥–æ–≤–∞—Ç—å¬ª, –∑–∞—Ç–µ–º –≤—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –≤ –±–æ—Ç–∞.</div>
    </div>
    <div style="background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:6px 10px;border-radius:999px;color:#06140a;font-weight:700">–ë—ã—Å—Ç—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ</div>
  </header>

  <!-- MAIN GALLERY -->
  <div id="mainView">
    <div class="grid" id="grid"></div>
  </div>

  <!-- DETAIL VIEW -->
  <div id="detailView" class="detail">
    <div class="detail-header">
      <div style="font-weight:700" id="detailTitle">Title</div>
      <div>
        <button id="detailBack" class="btn ghost">üîô –ù–∞–∑–∞–¥</button>
        <button id="rentBtn" class="btn primary">–ê—Ä–µ–Ω–¥–æ–≤–∞—Ç—å</button>
      </div>
    </div>

    <div class="viewer">
      <div class="imgwrap" id="imgWrap">
        <img id="detailImg" src="" alt="image"/>
      </div>

      <div class="nav" style="margin-top:12px">
        <button id="prevBtn" class="btn ghost">‚óÄÔ∏è</button>
        <button id="nextBtn" class="btn ghost">‚ñ∂Ô∏è</button>
      </div>

      <div class="pager" id="pager"></div>
      <div class="caption" id="detailCaption"></div>
    </div>
  </div>
</div>

<!-- Modal (initially hidden) -->
<div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" style="display:none">
  <div class="modal" role="document">
    <div class="modal-header">
      <div class="modal-title">–ö–æ–¥ –¥–ª—è –∞—Ä–µ–Ω–¥—ã</div>
      <button id="modalCloseIcon" class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
    </div>

    <div class="modal-body">
      <div style="flex:1">
        <div class="muted">–í–∞—à —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –±–æ—Ç–∞:</div>
        <div style="margin-top:10px;display:flex;align-items:center;gap:12px;flex-wrap:wrap">
          <div id="modalCode" class="code-big">GS00ABCD</div>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button id="modalCopy" class="btn primary">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button id="modalCopyClose" class="btn ghost">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–∫—Ä—ã—Ç—å</button>
          </div>
        </div>

        <div class="muted" style="margin-top:12px">–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º ‚Äî –±–æ—Ç –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏—è (–≤—Ä–µ–º—è –∏ —à–∞–≥–∏ –≤—ã–±–µ—Ä–µ—Ç–µ –≤ –±–æ—Ç–µ).</div>
      </div>

      <div style="min-width:140px;text-align:right">
        <div class="muted">–°–æ–≤–µ—Ç</div>
        <div class="muted" style="margin-top:8px">–ú–æ–¥–∞–ª –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.</div>
      </div>
    </div>

    <div class="modal-actions">
      <button id="modalClose" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<script>
/* ========== DATA ========== */
const ALL_SCENARIOS = [
  { title: "–õ–∏–∑–∞", short: "–¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–µ—Ö–∞–ª–∞ –≤ –ú–æ—Å–≤–∫—É –ø–æ—Å–ª–µ —Ä–∞—Å—Å—Ç–∞–≤–∞–Ω–∏—è —Å –ø–∞—Ä–Ω–µ–º, –æ–Ω–∞ –ø–æ—à–ª–∞ –≤ –∫–ª—É–± —á—Ç–æ–±—ã —É—Ç–µ—à–∏—Ç—å —Å–µ–±—è —Ç–∞–Ω—Ü–∞–º–∏.", caption: "–û–Ω–∞ ‚Äî –±–ª–æ–Ω–¥–∏–Ω–∫–∞ —Å –∏—Å–∫—Ä–µ–Ω–Ω–∏–º –≤–∑–≥–ª—è–¥–æ–º –∏ –ª—ë–≥–∫–æ–π —É–ª—ã–±–∫–æ–π. –ü–æ–ø—Ä–æ–±—É–µ—à—å –∑–∞–≥–æ–≤–æ—Ä–∏—Ç—å ‚Äî –∏ —É–≤–∏–¥–∏—à—å, —á—Ç–æ –∑–∞ –∫—Ä–∞—Å–æ—Ç–æ–π —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä.", images:[
      "31.jpg",
      "32.jpg",
      "33.jpg"
  ]},
  { title: "–ú–∞—Ä–≥–æ", short: "–ù–µ–¥–æ–ø–æ–Ω—è—Ç–∞—è —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ –≥–æ—Ç–∫–∞ –±—ã–ª–∞ –≤—ã–≥–Ω–∞—Ç–∞ –∏–∑ –∫–≤–∞—Ä—Ç–∏—Ä—ã –∑–∞ —Å–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –≤—ã –≤—Å—Ç—Ä–µ—á–∞–µ—Ç–µ –µ–µ —Ç–µ–º–Ω–æ–π —É–ª–∏—Ü–∞.", caption: "–¢—ë–º–Ω—ã–π –º–∞–∫–∏—è–∂ –∏ —Ö–æ–ª–æ–¥–Ω—ã–π –≤–∑–≥–ª—è–¥, –Ω–æ –≤–Ω—É—Ç—Ä–∏ ‚Äî –∂–∏–≤–∞—è –¥—É—à–∞, –∫–æ—Ç–æ—Ä–∞—è –ª—é–±–∏—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –¥–æ —É—Ç—Ä–∞.", images:[
      "23.jpg",
      "22.jpg",
      "21.jpg"
  ]},
  { title: "–ö–∏—Ä–∞", short: "–ö—Ä—É–≥–ª–∞—è –æ—Ç–ª–∏—á–Ω–∏—Ü–∞, —Å–æ–≥–ª–∞—Å–∏–ª–∞—Å—å –ø—Ä–æ–≥—É–ª—è—Ç—å—Å—è –≤ –≤–∞–º–∏ –ø–æ –ø–∞—Ä–∫—É", caption: "–û–Ω–∞ –±—É–¥—Ç–æ –∏–¥–µ–∞–ª—å–Ω–∞—è –æ—Ç–ª–∏—á–Ω–∏—Ü–∞, –Ω–æ –∑–∞ —ç—Ç–∏–º —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–≥–æ–Ω—å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–µ.", images:[
      "41.jpg",
      "42.jpg",
      "43.jpg"
  ]},
  { title: "–ù–∞—Å—Ç—è", short: "–õ—É—á—à–∞—è –ø–æ–¥—Ä—É–≥–∞ –Ω–µ –ø—Ä–æ—Ç–∏–≤ –ø—Ä–æ–≤–µ—Å—Ç–∏ —Å –≤–∞–º–∏ –≤—Ä–µ–º—è –≤ –∞–∫–≤–∞–ø–∞—Ä–∫–µ", caption: "–í–µ—Å—ë–ª–∞—è –∏ –¥–µ—Ä–∑–∫–∞—è ‚Äî —Å–ª–æ–≤–Ω–æ –ª—É—á—à–∏–π –¥—Ä—É–≥, —Ç–æ–ª—å–∫–æ —Å —É–ª—ã–±–∫–æ–π, –æ—Ç –∫–æ—Ç–æ—Ä–æ–π –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–æ—Ä–≤–∞—Ç—å—Å—è.", images:[
      "11.jpg",
      "12.jpg",
      "13.jpg"
  ]},   { title: "–í–¥–æ–≤–∞", short: "–•–ª–∞–¥–Ω–æ–∫—Ä–æ–≤–Ω–∞—è —É–±–∏–π—Ü–∞ –Ω–∞ –∫—Ä—ã—à–µ, –≥–¥–µ –≤—Å—ë —Ä–µ—à–∞–µ—Ç –æ–¥–Ω–æ –¥–≤–∏–∂–µ–Ω–∏–µ.", caption: "–û–Ω–∞ —Å–º–µ—Ä—Ç–æ–Ω–æ—Å–Ω–∞, –Ω–æ –ø–æ—á–µ–º—É-—Ç–æ –Ω–µ —Å–ø–µ—à–∏—Ç —É–±–∏—Ç—å —Ç–µ–±—è. –ì–æ—Ç–æ–≤ —Ä–∏—Å–∫–Ω—É—Ç—å?", images:[
    "51.jpg",
    "52.jpg",
    "53.jpg"
]},
{ title: "–õ–∞–Ω–∞", short: "–ù–∏–º—Ñ–æ–º–∞–Ω–∫–∞, –∫–æ—Ç–æ—Ä–æ–π –≤—Å–µ–≥–¥–∞ –º–∞–ª–æ ‚Äî –∏ –æ–Ω–∞ —ç—Ç–æ –Ω–µ —Å–∫—Ä—ã–≤–∞–µ—Ç.", caption: "–û–Ω–∞ –∏–≥—Ä–∞–µ—Ç —Å–ª–æ–≤–∞–º–∏ –∏ –∂–µ–ª–∞–Ω–∏—è–º–∏. –ü–æ–ø—Ä–æ–±—É–µ—à—å –ª–∏ –≤—ã–¥–µ—Ä–∂–∞—Ç—å –µ—ë —Ç–µ–º–ø?", images:[
    "61.jpg",
    "62.jpg",
    "63.jpg"
]},
{ title: "–õ–∞—Ä–∞", short: "–†–∞—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–∏—Ü–∞ –≥—Ä–æ–±–Ω–∏—Ü, —Å –∫–æ—Ç–æ—Ä–æ–π –≤—ã –∑–∞—Å—Ç—Ä—è–ª–∏ –≤ –æ–±–≤–∞–ª–∏–≤—à–µ–π—Å—è –ø–µ—â–µ—Ä–µ.", caption: "–û–Ω–∞ —Å–∏–ª—å–Ω–∞—è, —Å–º–µ–ª–∞—è, –Ω–æ —Ç–µ–ø–µ—Ä—å —Ç–æ–∂–µ –≤ –ª–æ–≤—É—à–∫–µ. –û—Å—Ç–∞–Ω–µ—Ç–µ—Å—å –ª–∏ –≤—ã —Å–æ—é–∑–Ω–∏–∫–∞–º–∏?", images:[
    "71.jpg",
    "72.jpg",
    "73.jpg"
]},
{ title: "–ú–∞–∫–∏–º–∞", short: "–û–ø–∞—Å–Ω–∞—è –≤–ª–∞—Å—Ç–Ω–∞—è –∂–µ–Ω—â–∏–Ω–∞, –∑–∞–∫—Ä—ã–≤—à–∞—è —Ç–µ–±—è –≤ –∫–ª–µ—Ç–∫–µ.", caption: "–û–Ω–∞ –≤–µ–¥—ë—Ç –¥–æ–ø—Ä–æ—Å, –Ω–æ –µ—ë –∏–≥—Ä–∞ –∫—É–¥–∞ –≥–ª—É–±–∂–µ, —á–µ–º –ø—Ä–æ—Å—Ç–æ –≤–æ–ø—Ä–æ—Å—ã.", images:[
    "81.jpg",
    "82.jpg",
    "83.jpg"
]},
];
/* ========================= */

const grid = document.getElementById('grid');
const mainView = document.getElementById('mainView');
const detailView = document.getElementById('detailView');
const detailImg = document.getElementById('detailImg');
const detailTitle = document.getElementById('detailTitle');
const detailCaption = document.getElementById('detailCaption');
const pager = document.getElementById('pager');
const rentBtn = document.getElementById('rentBtn');
const detailBack = document.getElementById('detailBack');

const modalBackdrop = document.getElementById('modalBackdrop');
const modalCode = document.getElementById('modalCode');
const modalCopy = document.getElementById('modalCopy');
const modalCopyClose = document.getElementById('modalCopyClose');
const modalClose = document.getElementById('modalClose');
const modalCloseIcon = document.getElementById('modalCloseIcon');

let chosenListIndices = [];
let chosenList = [];
let currentGlobalIndex = null;
let currentScenarioIndex = 0;
let slideIndex = 0;
let slideshowTimer = null;

/* Utility */
function pickRandomIndices(arrLength, n){
  const out = [];
  const idxs = Array.from({length: arrLength}, (_,i)=>i);
  while(out.length < n && idxs.length){
    const i = Math.floor(Math.random() * idxs.length);
    out.push(idxs.splice(i,1)[0]);
  }
  return out;
}

function randSuffix(){
  const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  let s=''; for(let i=0;i<8;i++) s += chars[Math.floor(Math.random()*chars.length)];
  return s;
}
function codeForIndex(idx){
  const pad = String(idx).padStart(2,'0');
  return 'GS' + pad + randSuffix();
}

/* Render main */
function renderMain(){
  grid.innerHTML = '';
  const take = Math.min(8, ALL_SCENARIOS.length);
  chosenListIndices = pickRandomIndices(ALL_SCENARIOS.length, take);
  chosenList = chosenListIndices.map(i => ALL_SCENARIOS[i]);

  chosenList.forEach((sc, localIdx) => {
    const card = document.createElement('div');
    card.className = 'card';
    const img = document.createElement('img');
    img.className = 'thumb';
    img.src = sc.images[0];
    img.alt = sc.title;

    const overlay = document.createElement('div');
    overlay.className = 'overlay';
    overlay.innerHTML = `<div class="title">${sc.title}</div><div class="short">${sc.short}</div>
                         <div class="btn-row"><button class="btn ghost">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button></div>`;

    card.appendChild(img);
    card.appendChild(overlay);

    card.addEventListener('click', (e)=>{
      if(window.innerWidth <= 900){
        if(!card.classList.contains('show-overlay')){
          card.classList.add('show-overlay');
          setTimeout(()=> card.classList.remove('show-overlay'), 3200);
          return;
        }
      }
      openDetail(localIdx);
    });

    img.addEventListener('dblclick', ()=> openDetail(localIdx));
    grid.appendChild(card);
  });
}

/* Detail open */
function openDetail(localIdx){
  currentScenarioIndex = localIdx;
  slideIndex = 0;
  currentGlobalIndex = chosenListIndices[localIdx];
  const sc = chosenList[localIdx];
  detailTitle.textContent = sc.title;
  detailCaption.textContent = sc.caption;
  detailImg.src = sc.images[slideIndex];
  renderPager(sc.images.length);
  mainView.style.display = 'none';
  detailView.classList.add('active');
  hideModal(); // ensure modal hidden
  startSlideshow();
  window.scrollTo({top:0, behavior:'smooth'});
}

/* Back to main */
function backToMain(){
  stopSlideshow();
  detailView.classList.remove('active');
  mainView.style.display = '';
}

/* Slideshow */
function renderPager(len){
  pager.innerHTML = '';
  for(let i=0;i<len;i++){
    const d = document.createElement('div');
    d.className = 'dot' + (i===slideIndex ? ' active' : '');
    d.addEventListener('click', ()=> {
      stopSlideshow();
      slideIndex = i;
      updateSlide();
      startSlideshow();
    });
    pager.appendChild(d);
  }
}
function updateSlide(){
  const sc = chosenList[currentScenarioIndex];
  detailImg.src = sc.images[slideIndex];
  renderPager(sc.images.length);
}
function nextSlide(){
  const sc = chosenList[currentScenarioIndex];
  slideIndex = (slideIndex + 1) % sc.images.length;
  updateSlide();
}
function prevSlide(){
  const sc = chosenList[currentScenarioIndex];
  slideIndex = (slideIndex - 1 + sc.images.length) % sc.images.length;
  updateSlide();
}
function startSlideshow(){
  stopSlideshow();
  slideshowTimer = setInterval(nextSlide, 3000); // 3 seconds
}
function stopSlideshow(){
  if(slideshowTimer){ clearInterval(slideshowTimer); slideshowTimer = null; }
}

/* Hook buttons */
detailBack.addEventListener('click', backToMain);
document.getElementById('prevBtn').addEventListener('click', ()=>{ stopSlideshow(); prevSlide(); startSlideshow(); });
document.getElementById('nextBtn').addEventListener('click', ()=>{ stopSlideshow(); nextSlide(); startSlideshow(); });

/* Modal control */
function showModalWithCode(code){
  modalCode.textContent = code;
  modalBackdrop.style.display = 'flex';
  // small delay to allow transition
  setTimeout(()=> modalBackdrop.classList.add('show'), 10);
  // try to copy immediately
  try{
    navigator.clipboard.writeText(code).then(()=> {
      modalCopy.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úì';
      setTimeout(()=> modalCopy.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 1400);
    }).catch(()=>{/* ignored if not allowed */});
  }catch(e){}
}
function hideModal(){
  modalBackdrop.classList.remove('show');
  setTimeout(()=> modalBackdrop.style.display = 'none', 180);
}

/* Rent button: show modal */
rentBtn.addEventListener('click', ()=> {
  const code = codeForIndex(currentGlobalIndex);
  showModalWithCode(code);
});

/* Modal buttons */
modalCopy.addEventListener('click', async ()=>{
  const txt = modalCode.textContent.trim();
  try{
    await navigator.clipboard.writeText(txt);
    modalCopy.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úì';
    setTimeout(()=> modalCopy.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 1400);
  }catch(e){
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é: ' + txt);
  }
});
modalCopyClose.addEventListener('click', async ()=>{
  const txt = modalCode.textContent.trim();
  try{ await navigator.clipboard.writeText(txt); }catch(e){}
  hideModal();
});
modalClose.addEventListener('click', hideModal);
modalCloseIcon.addEventListener('click', hideModal);

/* close on backdrop click */
modalBackdrop.addEventListener('click', (e)=> {
  if(e.target === modalBackdrop) hideModal();
});
/* close on ESC */
document.addEventListener('keydown', (e)=> { if(e.key === 'Escape') hideModal(); });

/* Init Telegram WebApp hints (optional) */
if(window.Telegram && Telegram.WebApp){
  try{ Telegram.WebApp.expand(); }catch(e){}
  try{ Telegram.WebApp.MainButton.hide(); }catch(e){}
}

/* Init */
renderMain();
</script>
</body>
</html>
